\hypertarget{structci__service__module}{
\section{ci\_\-service\_\-module Struct Reference}
\label{structci__service__module}\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}}
}


Is the structure which implements a service.  


{\ttfamily \#include $<$service.h$>$}\subsection*{Data Fields}
\begin{DoxyCompactItemize}
\item 
\hypertarget{structci__service__module_a2f37848274954bf289c4827c9c0ee735}{
const char $\ast$ \hyperlink{structci__service__module_a2f37848274954bf289c4827c9c0ee735}{mod\_\-name}}
\label{structci__service__module_a2f37848274954bf289c4827c9c0ee735}

\begin{DoxyCompactList}\small\item\em The service name. \item\end{DoxyCompactList}\item 
\hypertarget{structci__service__module_af35514696bd22c2b1300d837b9bd86f5}{
const char $\ast$ \hyperlink{structci__service__module_af35514696bd22c2b1300d837b9bd86f5}{mod\_\-short\_\-descr}}
\label{structci__service__module_af35514696bd22c2b1300d837b9bd86f5}

\begin{DoxyCompactList}\small\item\em Service short description. \item\end{DoxyCompactList}\item 
int \hyperlink{structci__service__module_a0d5dacfa1b760c7fab9dce70ce8d2703}{mod\_\-type}
\begin{DoxyCompactList}\small\item\em Service type. \item\end{DoxyCompactList}\item 
int($\ast$ \hyperlink{structci__service__module_acf9f56283f9418715be2f87967928876}{mod\_\-init\_\-service} )(\hyperlink{group__SERVICES_ga033e7bb0a88b3619abbc17230ad98eb4}{ci\_\-service\_\-xdata\_\-t} $\ast$srv\_\-xdata, struct \hyperlink{structci__server__conf}{ci\_\-server\_\-conf} $\ast$server\_\-conf)
\begin{DoxyCompactList}\small\item\em Pointer to the function called when the service loaded. \item\end{DoxyCompactList}\item 
int($\ast$ \hyperlink{structci__service__module_a3975fa968c80e30d77f3f1bac100e9e1}{mod\_\-post\_\-init\_\-service} )(\hyperlink{group__SERVICES_ga033e7bb0a88b3619abbc17230ad98eb4}{ci\_\-service\_\-xdata\_\-t} $\ast$srv\_\-xdata, struct \hyperlink{structci__server__conf}{ci\_\-server\_\-conf} $\ast$server\_\-conf)
\begin{DoxyCompactList}\small\item\em Pointer to the function which called after the c-\/icap initialized, but before the c-\/icap start serves requests. \item\end{DoxyCompactList}\item 
void($\ast$ \hyperlink{structci__service__module_a6ecb3941f63aed5ae248db8a679d69ae}{mod\_\-close\_\-service} )()
\begin{DoxyCompactList}\small\item\em Pointer to the function which called on c-\/icap server shutdown. \item\end{DoxyCompactList}\item 
void $\ast$($\ast$ \hyperlink{structci__service__module_a0ab686479bbf157f12c5913efd396c96}{mod\_\-init\_\-request\_\-data} )(struct ci\_\-request $\ast$req)
\begin{DoxyCompactList}\small\item\em Pointer to the function called when a new request for this services arrives to c-\/icap server. \item\end{DoxyCompactList}\item 
void($\ast$ \hyperlink{structci__service__module_ae809353c47dbfe742be12fe78d716373}{mod\_\-release\_\-request\_\-data} )(void $\ast$srv\_\-data)
\begin{DoxyCompactList}\small\item\em Pointer to the function which releases the service data. \item\end{DoxyCompactList}\item 
int($\ast$ \hyperlink{structci__service__module_a2a50b9701b4d11e996167c7c992256da}{mod\_\-check\_\-preview\_\-handler} )(char $\ast$preview\_\-data, int preview\_\-data\_\-len, struct ci\_\-request $\ast$req)
\begin{DoxyCompactList}\small\item\em Pointer to the function which is used to preview the ICAP client request. \item\end{DoxyCompactList}\item 
int($\ast$ \hyperlink{structci__service__module_a4308d4de90013030d311b56d01ba1d53}{mod\_\-end\_\-of\_\-data\_\-handler} )(struct ci\_\-request $\ast$req)
\begin{DoxyCompactList}\small\item\em Pointer to the function called when the icap client has send all the data to the service. \item\end{DoxyCompactList}\item 
int($\ast$ \hyperlink{structci__service__module_ac79b8c4bd560ee1f5cb21ca604c90978}{mod\_\-service\_\-io} )(char $\ast$wbuf, int $\ast$wlen, char $\ast$rbuf, int $\ast$rlen, int iseof, struct ci\_\-request $\ast$req)
\begin{DoxyCompactList}\small\item\em Pointer to the function called to read/send body data from/to icap client. \item\end{DoxyCompactList}\item 
struct \hyperlink{structci__conf__entry}{ci\_\-conf\_\-entry} $\ast$ \hyperlink{structci__service__module_a51f0f2512caf13fc7c39337e2060686d}{mod\_\-conf\_\-table}
\begin{DoxyCompactList}\small\item\em Pointer to the config table of the service. \item\end{DoxyCompactList}\item 
void $\ast$ \hyperlink{structci__service__module_a548856fadc824a5dcc627664e738f2c9}{mod\_\-data}
\begin{DoxyCompactList}\small\item\em NULL pointer. \item\end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Is the structure which implements a service. To implement a service someones needs to implement the member functions of this struct. These functions will be called by c-\/icap as follows:
\begin{DoxyItemize}
\item New request arrives for this service -\/$>$ The \hyperlink{structci__service__module_a0ab686479bbf157f12c5913efd396c96}{ci\_\-service\_\-module::mod\_\-init\_\-request\_\-data} called
\item The icap client sends preview data -\/$>$ The \hyperlink{structci__service__module_a2a50b9701b4d11e996167c7c992256da}{ci\_\-service\_\-module::mod\_\-check\_\-preview\_\-handler} called. If this function return CI\_\-MOD\_\-ALLOW204 the ICAP transaction stops here. If this function return CI\_\-MOD\_\-CONTINUE the ICAP client will send the rest body data if exists.
\item The client starts sends more data -\/$>$ \hyperlink{structci__service__module_ac79b8c4bd560ee1f5cb21ca604c90978}{ci\_\-service\_\-module::mod\_\-service\_\-io} called multiple times until the client has send all the body data. The service can start send data using this function to the client before all data has received
\item The client has send all data -\/$>$ the \hyperlink{structci__service__module_a4308d4de90013030d311b56d01ba1d53}{ci\_\-service\_\-module::mod\_\-end\_\-of\_\-data\_\-handler} called
\item The client waits to read the rest data from c-\/icap -\/$>$ \hyperlink{structci__service__module_ac79b8c4bd560ee1f5cb21ca604c90978}{ci\_\-service\_\-module::mod\_\-service\_\-io} called multiple times until all the body data send to the client 
\end{DoxyItemize}\begin{Desc}
\item[Examples: ]\par


\hyperlink{services_2echo_2srv__echo_8c-example}{services/echo/srv\_\-echo.c}.\end{Desc}


\subsection{Field Documentation}
\hypertarget{structci__service__module_a2a50b9701b4d11e996167c7c992256da}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-check\_\-preview\_\-handler@{mod\_\-check\_\-preview\_\-handler}}
\index{mod\_\-check\_\-preview\_\-handler@{mod\_\-check\_\-preview\_\-handler}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-check\_\-preview\_\-handler}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ {\bf ci\_\-service\_\-module::mod\_\-check\_\-preview\_\-handler})(char $\ast$preview\_\-data, int preview\_\-data\_\-len, struct ci\_\-request $\ast$req)}}
\label{structci__service__module_a2a50b9701b4d11e996167c7c992256da}


Pointer to the function which is used to preview the ICAP client request. The client if supports preview sends some data for examination. The service using this function will decide if the client request must processed so the client must send more data or no modification/processing needed so the request ended here. 
\begin{DoxyParams}{Parameters}
\item[{\em preview\_\-data}]Pointer to the preview data \item[{\em preview\_\-data\_\-len}]The size of preview data \item[{\em req}]pointer to the related ci\_\-request struct \end{DoxyParams}
\begin{DoxyReturn}{Returns}
CI\_\-MOD\_\-CONTINUE if the client must send more data, CI\_\-MOD\_\-ALLOW204 if the service does not want to modify anything, or CI\_\-ERROR on errors. 
\end{DoxyReturn}
\hypertarget{structci__service__module_a6ecb3941f63aed5ae248db8a679d69ae}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-close\_\-service@{mod\_\-close\_\-service}}
\index{mod\_\-close\_\-service@{mod\_\-close\_\-service}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-close\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}void($\ast$ {\bf ci\_\-service\_\-module::mod\_\-close\_\-service})()}}
\label{structci__service__module_a6ecb3941f63aed5ae248db8a679d69ae}


Pointer to the function which called on c-\/icap server shutdown. This function can be used to release service allocated resources \hypertarget{structci__service__module_a51f0f2512caf13fc7c39337e2060686d}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-conf\_\-table@{mod\_\-conf\_\-table}}
\index{mod\_\-conf\_\-table@{mod\_\-conf\_\-table}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-conf\_\-table}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf ci\_\-conf\_\-entry}$\ast$ {\bf ci\_\-service\_\-module::mod\_\-conf\_\-table}\hspace{0.3cm}{\ttfamily  \mbox{[}read\mbox{]}}}}
\label{structci__service__module_a51f0f2512caf13fc7c39337e2060686d}


Pointer to the config table of the service. Is an array which contains the definitions of configuration parameters used by the service. The configuration parameters defined in this array can be used in c-\/icap.conf file. \hypertarget{structci__service__module_a548856fadc824a5dcc627664e738f2c9}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-data@{mod\_\-data}}
\index{mod\_\-data@{mod\_\-data}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ {\bf ci\_\-service\_\-module::mod\_\-data}}}
\label{structci__service__module_a548856fadc824a5dcc627664e738f2c9}


NULL pointer. This field does not used. Set it to NULL. \hypertarget{structci__service__module_a4308d4de90013030d311b56d01ba1d53}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-end\_\-of\_\-data\_\-handler@{mod\_\-end\_\-of\_\-data\_\-handler}}
\index{mod\_\-end\_\-of\_\-data\_\-handler@{mod\_\-end\_\-of\_\-data\_\-handler}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-end\_\-of\_\-data\_\-handler}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ {\bf ci\_\-service\_\-module::mod\_\-end\_\-of\_\-data\_\-handler})(struct ci\_\-request $\ast$req)}}
\label{structci__service__module_a4308d4de90013030d311b56d01ba1d53}


Pointer to the function called when the icap client has send all the data to the service. This function called when the ICAP client has send all data. 
\begin{DoxyParams}{Parameters}
\item[{\em req}]pointer to the related ci\_\-request struct \end{DoxyParams}
\begin{DoxyReturn}{Returns}
CI\_\-MOD\_\-DONE if all are OK, CI\_\-MOD\_\-ALLOW204 if the ICAP client request supports 204 responses and we are not planning to modify anything, or CI\_\-ERROR on errors. The service must not return CI\_\-MOD\_\-ALLOW204 if has already send some data to the client, or the client does not support allow204 responses. To examine if client supports 204 responses the developer should use the ci\_\-req\_\-allow204 macro 
\end{DoxyReturn}
\hypertarget{structci__service__module_a0ab686479bbf157f12c5913efd396c96}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-init\_\-request\_\-data@{mod\_\-init\_\-request\_\-data}}
\index{mod\_\-init\_\-request\_\-data@{mod\_\-init\_\-request\_\-data}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-init\_\-request\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$($\ast$ {\bf ci\_\-service\_\-module::mod\_\-init\_\-request\_\-data})(struct ci\_\-request $\ast$req)}}
\label{structci__service__module_a0ab686479bbf157f12c5913efd396c96}


Pointer to the function called when a new request for this services arrives to c-\/icap server. This function should inititalize the data and structures required for serving the request. 
\begin{DoxyParams}{Parameters}
\item[{\em req}]a pointer to the related ci\_\-request\_\-t structure \end{DoxyParams}
\begin{DoxyReturn}{Returns}
a void pointer to the user defined data required for serving the request. The developer can obtain the service data from the related ci\_\-request\_\-t object using the macro ci\_\-service\_\-data 
\end{DoxyReturn}
\hypertarget{structci__service__module_acf9f56283f9418715be2f87967928876}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-init\_\-service@{mod\_\-init\_\-service}}
\index{mod\_\-init\_\-service@{mod\_\-init\_\-service}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-init\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ {\bf ci\_\-service\_\-module::mod\_\-init\_\-service})({\bf ci\_\-service\_\-xdata\_\-t} $\ast$srv\_\-xdata, struct {\bf ci\_\-server\_\-conf} $\ast$server\_\-conf)}}
\label{structci__service__module_acf9f56283f9418715be2f87967928876}


Pointer to the function called when the service loaded. This function called exactly when the service loaded by c-\/icap. Can be used to initialize the service. 
\begin{DoxyParams}{Parameters}
\item[{\em srv\_\-xdata}]Pointer to the ci\_\-service\_\-xdata\_\-t object of this service \item[{\em server\_\-conf}]Pointer to the struct holds the main c-\/icap server configuration \end{DoxyParams}
\begin{DoxyReturn}{Returns}
CI\_\-OK on success, CI\_\-ERROR on any error. 
\end{DoxyReturn}
\hypertarget{structci__service__module_a3975fa968c80e30d77f3f1bac100e9e1}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-post\_\-init\_\-service@{mod\_\-post\_\-init\_\-service}}
\index{mod\_\-post\_\-init\_\-service@{mod\_\-post\_\-init\_\-service}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-post\_\-init\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ {\bf ci\_\-service\_\-module::mod\_\-post\_\-init\_\-service})({\bf ci\_\-service\_\-xdata\_\-t} $\ast$srv\_\-xdata, struct {\bf ci\_\-server\_\-conf} $\ast$server\_\-conf)}}
\label{structci__service__module_a3975fa968c80e30d77f3f1bac100e9e1}


Pointer to the function which called after the c-\/icap initialized, but before the c-\/icap start serves requests. This function can be used to initialize the service. Unlike to the \hyperlink{structci__service__module_acf9f56283f9418715be2f87967928876}{ci\_\-service\_\-module::mod\_\-init\_\-service} when this function called the c-\/icap has initialized and it is known other system parameters like the services and modules which are loaded, network ports and addresses c-\/icap is listening etc. 
\begin{DoxyParams}{Parameters}
\item[{\em srv\_\-xdata}]Pointer to the ci\_\-service\_\-xadata\_\-t object of this service \item[{\em server\_\-conf}]Pointer to the struct holds the main c-\/icap server configuration \end{DoxyParams}
\begin{DoxyReturn}{Returns}
CI\_\-OK on success, CI\_\-ERROR on errors. 
\end{DoxyReturn}
\hypertarget{structci__service__module_ae809353c47dbfe742be12fe78d716373}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-release\_\-request\_\-data@{mod\_\-release\_\-request\_\-data}}
\index{mod\_\-release\_\-request\_\-data@{mod\_\-release\_\-request\_\-data}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-release\_\-request\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}void($\ast$ {\bf ci\_\-service\_\-module::mod\_\-release\_\-request\_\-data})(void $\ast$srv\_\-data)}}
\label{structci__service__module_ae809353c47dbfe742be12fe78d716373}


Pointer to the function which releases the service data. This function called after the user request served to release the service data 
\begin{DoxyParams}{Parameters}
\item[{\em srv\_\-data}]pointer to the service data returned by the \hyperlink{structci__service__module_a0ab686479bbf157f12c5913efd396c96}{ci\_\-service\_\-module::mod\_\-init\_\-request\_\-data} call \end{DoxyParams}
\hypertarget{structci__service__module_ac79b8c4bd560ee1f5cb21ca604c90978}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-service\_\-io@{mod\_\-service\_\-io}}
\index{mod\_\-service\_\-io@{mod\_\-service\_\-io}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-service\_\-io}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ {\bf ci\_\-service\_\-module::mod\_\-service\_\-io})(char $\ast$wbuf, int $\ast$wlen, char $\ast$rbuf, int $\ast$rlen, int iseof, struct ci\_\-request $\ast$req)}}
\label{structci__service__module_ac79b8c4bd560ee1f5cb21ca604c90978}


Pointer to the function called to read/send body data from/to icap client. This function reads body data from the ICAP client and sends back the modified body data To allow c-\/icap send data to the ICAP client before all data received by the c-\/icap a call to the ci\_\-req\_\-unlock\_\-data function required. 
\begin{DoxyParams}{Parameters}
\item[{\em wbuf}]The buffer for writing data to the ICAP client \item[{\em wlen}]The size of the write buffer. It must modified to be the size of writing data. If the service has send all the data to the client this parameter must set to CI\_\-EOF. \item[{\em rbuf}]Pointer to the data read from the ICAP client \item[{\em rlen}]The lenght of the data read from the ICAP client. If this function for a reason can not read all the data, it must modify the rlen to be equal to the read data \item[{\em iseof}]It has non zero value if the data in rbuf buffer are the last data from the ICAP client. \item[{\em req}]pointer to the related ci\_\-request struct \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Return CI\_\-OK if all are OK or CI\_\-ERROR on errors 
\end{DoxyReturn}
\hypertarget{structci__service__module_a0d5dacfa1b760c7fab9dce70ce8d2703}{
\index{ci\_\-service\_\-module@{ci\_\-service\_\-module}!mod\_\-type@{mod\_\-type}}
\index{mod\_\-type@{mod\_\-type}!ci_service_module@{ci\_\-service\_\-module}}
\subsubsection[{mod\_\-type}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf ci\_\-service\_\-module::mod\_\-type}}}
\label{structci__service__module_a0d5dacfa1b760c7fab9dce70ce8d2703}


Service type. The service type can be ICAP\_\-RESPMOD for a responce modification service, ICAP\_\-REQMOD for request modification service or ICAP\_\-RESPMOD$|$ICAP\_\-REQMOD for a service implements both response and request modification 

The documentation for this struct was generated from the following file:\begin{DoxyCompactItemize}
\item 
include/service.h\end{DoxyCompactItemize}
